<div class="checkout-container">
  
  <div *ngIf="isLoading" class="state-container loading">
    <div class="spinner"></div>
    <h3>Processing Payment...</h3>
    <p>Please do not refresh the page.</p>
  </div>

  <div *ngIf="orderPlaced" class="state-container success">
    <div class="icon">üéâ</div>
    <h2>Order Confirmed!</h2>
    <p>Your order has been placed successfully.</p>
    <p class="sub-text">An invoice has been sent to your email.</p>
    <a routerLink="/shop" class="btn-primary">Continue Shopping</a>
  </div>

  <div *ngIf="!isLoading && !orderPlaced" class="form-wrapper">
    <div class="header">
      <h2>Secure Checkout</h2>
      <p>Complete your purchase details below.</p>
    </div>
    
    <form [formGroup]="checkoutForm" (ngSubmit)="onSubmit()">
      
      <section class="card-section">
        <h3>üìç Shipping Address</h3>
        
        <div class="form-group">
          <label>Street Address</label>
          <input type="text" formControlName="line1" placeholder="address line 1" 
                 [class.invalid]="checkoutForm.get('line1')?.invalid && checkoutForm.get('line1')?.touched">
        </div>
        
        <div class="row">
          <div class="form-group half">
            <label>City</label>
            <input type="text" formControlName="city" placeholder="Chennai">
          </div>
          <div class="form-group half">
            <label>State</label>
            <input type="text" formControlName="state" placeholder="Tamil Nadu">
          </div>
        </div>

        <div class="form-group">
          <label>Pincode / Zip</label>
          <input type="text" formControlName="pincode" placeholder="600034">
          <small class="error-msg" *ngIf="checkoutForm.get('pincode')?.hasError('pattern')">
            Please enter a valid 6-digit Pincode.
          </small>
        </div>
      </section>

      <section class="card-section">
        <h3>üí≥ Payment Method</h3>
        
        <div class="form-group">
          <label>Email for Invoice</label>
          <input type="email" formControlName="email" placeholder="you@example.com">
        </div>

        <div class="payment-options">
          <label class="payment-card" [class.active]="checkoutForm.get('paymentMode')?.value === 'CARD'">
            <input type="radio" formControlName="paymentMode" value="CARD">
            <span class="mode-name">Credit Card</span>
          </label>
          
          <label class="payment-card" [class.active]="checkoutForm.get('paymentMode')?.value === 'UPI'">
            <input type="radio" formControlName="paymentMode" value="UPI">
            <span class="mode-name">UPI</span>
          </label>
          
          <label class="payment-card" [class.active]="checkoutForm.get('paymentMode')?.value === 'COD'">
            <input type="radio" formControlName="paymentMode" value="COD">
            <span class="mode-name">Cash on Delivery</span>
          </label>
        </div>

        <div class="dynamic-input" *ngIf="checkoutForm.get('paymentMode')?.value === 'CARD'">
          <label>Card Number</label>
          <input type="text" formControlName="cardNumber" placeholder="XXXX XXXX XXXX XXXX">
        </div>

        <div class="dynamic-input" *ngIf="checkoutForm.get('paymentMode')?.value === 'UPI'">
          <label>UPI ID</label>
          <input type="text" formControlName="upiId" placeholder="username@oksbi">
        </div>
      </section>

      <div class="action-area">
        <div class="total-display">
          <span>Total to Pay:</span>
          <span class="amount">Rs {{ totalPrice() | number:'1.2-2' }}</span>
          </div>
        <button type="submit" [disabled]="checkoutForm.invalid" class="pay-btn">
          Pay Rs {{ totalPrice() | number:'1.2-2' }}
        </button>
      </div>
      
    </form>
  </div>
</div>